<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Client Details</title>
    <style>
        body { font-family: sans-serif; margin: 2em; background-color: #f4f4f4; }
        .container { max-width: 800px; margin: auto; background: white; padding: 2em; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { color: #3f51b5; text-align: center; }
        .client-info p { margin: 0.5em 0; }
        .client-info label { font-weight: bold; color: #555; }
        .back-link { display: block; margin-top: 2em; text-align: center; }

        .task-form { margin-top: 2em; border-top: 1px solid #ddd; padding-top: 1em; }
        .task-list { margin-top: 2em; }
        .task-item { border: 1px solid #ccc; padding: 1em; margin-bottom: 1em; border-radius: 8px; }
        .task-item h3 { margin-top: 0; }
        .task-item .status { font-weight: bold; }

        .form-group {
            margin-bottom: 1em;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.5em;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }
        .task-form input[type="submit"] {
            background-color: #3f51b5;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .task-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1em;
        }
        .task-table th, .task-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .task-table th {
            background-color: #f2f2f2;
            color: #555;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>{{ client.company_name }}</h1>
        <div class="client-info">
            <p><label>Contact Person:</label> {{ client.contact_person }}</p>
            <p><label>Country:</label> {{ client.country }}</p>
            <p><label>System User:</label> {{ client.system_user }}</p>
            <p><label>Status:</label> {{ client.status }}</p>
            {% if client.status == 'On Hold' %}
                <p><label>Reason for Roadblock:</label> {{ client.reason_for_roadblock }}</p>
            {% endif %}
            <p><label>Offered Product:</label> {{ client.get_offered_product_display }}</p>
            <p><label>Potential Market Share:</label> {{ client.potential_market_share }}%</p>
            <p><label>Potential Yearly Sales:</label> â‚¬{{ client.potential_yearly_sales }}</p>
            <p><label>Last Action:</label> {{ client.last_action }}</p>
            <p><label>Next Action:</label> {{ client.next_action }}</p>
            <p><label>Comment/Feedback:</label> {{ client.comment_feedback }}</p>
        </div>

        <a href="{% url 'client_update' client.pk %}">Edit Client</a> | 
        <a href="{% url 'client_delete' client.pk %}">Delete Client</a>

        <hr>

        <div class="task-form">
            <h2>Add New Task</h2>
            <form method="post">
                {% csrf_token %}
                <div class="form-group">
                    <label for="{{ task_form.action.id_for_label }}">Action:</label>
                    {{ task_form.action }}
                </div>
                <div class="form-group">
                    <label for="{{ task_form.assigned_to.id_for_label }}">Assigned to:</label>
                    {{ task_form.assigned_to }}
                </div>
                <div class="form-group">
                    <label for="{{ task_form.due_date.id_for_label }}">Due date:</label>
                    {{ task_form.due_date }}
                </div>
                <div class="form-group">
                    <label for="{{ task_form.status.id_for_label }}">Status:</label>
                    {{ task_form.status }}
                </div>
                <div class="form-group">
                    <label for="{{ task_form.comment.id_for_label }}">Comment:</label>
                    {{ task_form.comment }}
                </div>
                <input type="submit" value="Add Task">
            </form>
        </div>

        <div class="task-list">
            <h2>Open Tasks</h2>
            {% if tasks %}
            <table class="task-table">
                <thead>
                    <tr>
                        <th>Action</th>
                        <th>Assigned To</th>
                        <th>Due Date</th>
                        <th>Status</th>
                        <th>Comment</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for task in tasks %}
                    <tr>
                        <td>{{ task.action }}</td>
                        <td>{{ task.assigned_to }}</td>
                        <td>{{ task.due_date }}</td>
                        <td>{{ task.status }}</td>
                        <td>{{ task.comment }}</td>
                        <td>
                            <a href="{% url 'task_update' pk=task.pk %}">Edit</a> |
                            {% if task.is_archived %}
                                <a href="{% url 'task_delete' pk=task.pk %}" onclick="return confirm('Are you sure?');">Delete</a>
                            {% else %}
                                <a href="{% url 'task_archive' pk=task.pk %}">Archive</a>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p>No open tasks for this client.</p>
            {% endif %}
        </div>

        <hr>

        <a class="back-link" href="{% url 'client_list' %}">Back to Client List</a>
    </div>

</body>
</html>